using Base.Test
include("eegutilities.jl")




@testset "Normalize Tests" begin
@test normalize([2 4 8]) == [.25 .5 1]
@test normalize([1, 2, 4]) == [0.25, 0.5, 1]
end

@testset "Threshold_01 Tests" begin
@test threshold_01([1 2 3 4 5 6 7 8 9 10.5], 4) == [0 0 0 1 1 1 1 1 1 1]
@test threshold_01([1 2 3; 4 5 6], 3) == [0 0 1; 1 1 1]
end

#TODO highpass and lowpass tests aren't working yet
@testset "Lowpass Tests" begin
    q = linspace(0,1,150)
    sindata = sin(60*2*pi*q) + sin(200*2*pi*q)

    @test begin
        actual = lowpass(sindata, 65, 150)
        # print(format_full_array(actual))
        expected = [0.0, 0.711807070637017647030120315321, 0.025983875960371365793077913509, -0.975665099512987521457318962348, 1.104035186642847277127543748065, -0.266893794419766960945850087228, -0.817462414627789457632900393946, 1.273099211593460511338093965605, -0.830233202467945186064923746017, -0.003888329466166770814056219407, 0.474927770974582774687888786502, -0.294331015444627863697490965933, -0.127566301914583707377559562701, 0.131323544000171404944055097985, 0.494892464367036377659303525434, -1.240626088402048798897681081144, 1.302335434888988840995693863078, -0.343400446981696749748635966171, -1.111721553004237250661390135065, 2.036359240742044107719266321510, -1.730011944588890848706341785146, 0.403478608388685155983210961494, 0.990167872702820028862902290712, -1.532666760858142573908935446525, 1.052551444354962173477474607353, -0.170022062775824905900279304660, -0.326773876817456787602367285217, 0.187763674268896757491020821362, 0.146564169498526603030441606279, -0.057529027763216084023767393774, -0.578832637767136670703393974691, 1.207478853436902754836523854465, -1.091047778282459912446711314260, 0.039884927127425487403122872365, 1.307929057707019282474902865943, -1.949256586807033730934790582978, 1.344372405710752671481600373227, 0.109491053130903903678472488536, -1.382601769568396754550576588372, 1.639885896977429702303652447881, -0.880674677200861344417148757202, -0.145501185912555924817368691038, 0.640093315106287308324795048975, -0.431111679512735268549050715592, 0.029052304813484038092941119658, -0.048721610875113723071461180325, 0.562060561731893004733251473226, -1.000299739101531137919209868414, 0.705865418684831547047053845745, 0.378596080009681534850329853725, -1.541301848634604398924352608446, 1.847665483545442688395610275620, -0.943115527150253929455914203572, -0.598214195547864813207183942723, 1.704375960385665855767456378089, -1.658411064108016530482814232528, 0.644114636764766990140174129920, 0.471603391112516701078050118667, -0.904332521595982985473938242649, 0.580078862819176310772206761612, -0.087183551539338557945235663738, 0.037383763441795718474036647194, -0.452516109982090131147458578198, 0.753216100712028491237504113087, -0.356763801522777979080558452551, -0.683330236014582315107190879644, 1.615171731525234299908788671019, -1.600021740136899017770133468730, 0.469316531188096186522074049208, 1.056856492254182766643566537823, -1.911321288083325464768336132693, 1.531417497223027668340478157916, -0.291676789834516836386058002972, -0.846093699843214364086918521934, 1.144832920580176605085398477968, -0.652989118473732865766123723006, 0.045267041318355134837947417736, 0.070803178475895220400637697367, 0.274755011126033232837784225921, -0.490419776591868861181922056858, 0.059166485507823399214721860062, 0.877332742508083796018070188438, -1.556847171599081036674760980532, 1.255178536416747592241449638095, 0.019215585174998460471496031232, -1.437087700222884345535590000509, 1.981158376271750176655928044056, -1.270024983572049848135065985844, -0.137021903884364582015820133165, 1.215385365485875501789791996998, -1.311883298766742145247121698048, 0.618730513420476802011194195074, 0.101542682757880475818978993630, -0.254796485497854274804296892398, -0.068185009291064233027945817867, 0.256899703760972208943513805934, 0.151432388052147398616043005859, -0.947540942571093447455155001080, 1.381371620873549366237398317026, -0.851254686391156645264288727049, -0.476164676066124337161511448357, 1.703297939518428893990176220541, -1.903556018810384387052181409672, 0.892885308365814811537575224065, 0.602726192189906195828541513038, -1.535629458780413347795956724440, 1.373414883322082502559169370215, -0.467585576199317620726958466548, -0.338508717113542023646743928111, 0.481057542010681016275697174933, -0.125787367073894290614433089104, -0.088658810550375596881700346330, -0.256775590947932674801279517851, 0.901045284768547505294122856867, -1.120458383179613548463748884387, 0.434207121811082952245186561413, 0.858529210296675837632562888757, -1.832665153056348472659919934813, 1.685344772680893221661335701356, -0.433655467489965196214996012714, -1.058742676522795855831304834282, 1.765400136594332813899654865963, -1.308179596265904853780170924438, 0.204659669373982167073222626641, 0.637620164395538036039567941771, -0.709071750872043993219051571941, 0.267520113166991035935637910370, 0.011773987288183997146351345009, 0.253274159850861324549953224050, -0.759135508045440277058446554292, 0.814273185097985630065409168310, -0.049297464924984539524910331920, -1.133226849006411018905282617197, 1.818015207277915434858073240321, -1.348898163097543623223373288056, -0.064449562171188731762860868457, 1.458370526560116120506904735521, -1.872695321863464990030934131937, 1.110160899194369221731903962791, 0.149495015309392659252907265000, -0.960639862303336644622220319434, 0.896746620694372720272724563984, -0.324851250581566441955061463887, -0.038404435717768810321093297944, -0.152911344755877365297891401497, 0.554886158483838820565381411143, -0.506679353515239183636253983423, -0.264162743790698040236009092041, 1.280817162616812998621185215598, -1.668553304409151172293945819547, ]
        actual ≈ expected
    end

end

@testset "Highpass Tests" begin
q = linspace(0,1,410)
sindata = sin(60*2*pi*q) + sin(200*2*pi*q)
@test highpass(sindata, 200, 410) ≈ [0.0,1.03108e-7,-1.14123e-6,6.28374e-6,-2.32281e-5,6.55812e-5,-0.000152309,0.000305471,-0.000547505,0.000899177,-0.00137845,0.00199974,-0.00277311,0.00370387,-0.00479312,0.00603985,-0.00744357,0.0090059,-0.0107299,0.0126174,-0.0146654,0.0168648,-0.0192002,0.021653,-0.0242035,0.0268325,-0.0295218,0.0322548,-0.0350156,0.0377902,-0.0405645,0.0433232,-0.0460475,0.0487145,-0.0512993,0.0537778,-0.0561305,0.0583436,-0.0604077,0.0623157,-0.0640596,0.0656303,-0.0670174,0.0682103,-0.0691983,0.0699716,-0.0705224,0.0708464,-0.0709448,0.0708235,-0.0704914,0.0699568,-0.069225,0.0682976,-0.0671746,0.0658579,-0.0643529,0.0626693,-0.0608199,0.0588196,-0.0566842,0.0544295,-0.0520706,0.0496201,-0.0470874,0.0444795,-0.0418032,0.0390684,-0.0362896,0.0334856,-0.0306759,0.0278782,-0.0251058,0.0223682,-0.0196723,0.0170242,-0.0144299,0.0118964,-0.0094317,0.00704581,-0.00475084,0.00255961,-0.00048305,-0.00147247,0.00330609,-0.00502093,0.00662082,-0.00810715,0.00947768,-0.0107275,0.0118514,-0.0128451,0.0137071,-0.0144381,0.0150416,-0.0155235,0.0158924,-0.0161573,0.0163255,-0.0164004,0.0163815,-0.0162667,0.0160554,-0.0157515,0.0153636,-0.014903,0.0143813,-0.0138082,0.0131911,-0.0125349,0.0118431,-0.0111173,0.0103586,-0.00956853,0.00875169,-0.00791648,0.00707453,-0.00623787,0.00541548,-0.00461135,0.00382501,-0.00305404,0.00229697,-0.00155492,0.000831644,-0.000132638,-0.00053574,0.00116693,-0.00175499,0.00229601,-0.00278956,0.00323919,-0.00365092,0.0040302,-0.00437895,0.00469442,-0.00497061,0.00520137,-0.00538325,0.00551666,-0.00560518,0.00565406,-0.00566898,0.00565523,-0.00561704,0.00555651,-0.0054728,0.00536231,-0.00522062,0.00504542]
end

@testset "Downsample Tests" begin
@test dsample([1,2,3,4,5,6,7,8], 1/2) = [1,3,5,7]
end
